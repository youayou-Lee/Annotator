# æ–‡ä¹¦æ ‡æ³¨ç³»ç»Ÿ - åç«¯

åŸºäº FastAPI çš„æ–‡ä¹¦æ ‡æ³¨ç³»ç»Ÿåç«¯æœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” JWT è®¤è¯ç³»ç»Ÿ
- ğŸ‘¥ ç”¨æˆ·ç®¡ç†ï¼ˆè¶…çº§ç®¡ç†å‘˜ã€ç®¡ç†å‘˜ã€æ ‡æ³¨å‘˜ï¼‰
- ğŸ“ æ–‡ä»¶ç®¡ç†ï¼ˆä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆï¼‰
- ğŸ“‹ ä»»åŠ¡ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ†é…ã€è·Ÿè¸ªï¼‰
- âœï¸ æ ‡æ³¨åŠŸèƒ½ï¼ˆæ ‡æ³¨ã€æäº¤ã€å¤å®¡ï¼‰
- ğŸ“Š æƒé™æ§åˆ¶
- ğŸ’¾ æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: FastAPI 0.104.1
- **è®¤è¯**: JWT (python-jose)
- **å¯†ç åŠ å¯†**: bcrypt (passlib)
- **æ•°æ®éªŒè¯**: Pydantic 2.6.1
- **æ–‡ä»¶å¤„ç†**: aiofiles, python-multipart
- **æœåŠ¡å™¨**: Uvicorn

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py          # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ task.py          # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ annotation.py    # æ ‡æ³¨æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ file.py          # æ–‡ä»¶æ¨¡å‹
â”‚   â”‚   â””â”€â”€ auth.py          # è®¤è¯æ¨¡å‹
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ security.py      # å®‰å…¨è®¤è¯
â”‚   â”‚   â””â”€â”€ storage.py       # å­˜å‚¨ç®¡ç†
â”‚   â””â”€â”€ api/                 # APIè·¯ç”±
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ auth.py          # è®¤è¯æ¥å£
â”‚       â”œâ”€â”€ users.py         # ç”¨æˆ·ç®¡ç†
â”‚       â”œâ”€â”€ files.py         # æ–‡ä»¶ç®¡ç†
â”‚       â”œâ”€â”€ tasks.py         # ä»»åŠ¡ç®¡ç†
â”‚       â””â”€â”€ annotations.py   # æ ‡æ³¨åŠŸèƒ½
â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ .env.example             # ç¯å¢ƒé…ç½®ç¤ºä¾‹
â”œâ”€â”€ run.py                   # å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²æ¿€æ´» conda ç¯å¢ƒï¼š
```bash
conda activate annotator
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r ../requirements.txt
```

### 3. é…ç½®ç¯å¢ƒ

å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œä¿®æ”¹å¿…è¦çš„é…ç½®é¡¹ï¼ˆç‰¹åˆ«æ˜¯ SECRET_KEYï¼‰ã€‚

### 4. å¯åŠ¨æœåŠ¡

```bash
python run.py
```

æˆ–è€…ä½¿ç”¨ uvicorn ç›´æ¥å¯åŠ¨ï¼š
```bash
uvicorn app.main:app --reload --port 8000
```

### 5. è®¿é—®æœåŠ¡

- æœåŠ¡åœ°å€: http://localhost:8000
- API æ–‡æ¡£: http://localhost:8000/docs
- ReDoc æ–‡æ¡£: http://localhost:8000/redoc

## API æ¥å£

### è®¤è¯æ¥å£
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### ç”¨æˆ·ç®¡ç†
- `GET /api/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /api/users/{user_id}` - è·å–ç”¨æˆ·è¯¦æƒ…
- `PUT /api/users/{user_id}` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

### æ–‡ä»¶ç®¡ç†
- `GET /api/files` - è·å–æ–‡ä»¶åˆ—è¡¨
- `POST /api/files/upload` - ä¸Šä¼ æ–‡ä»¶
- `DELETE /api/files/{file_id}` - åˆ é™¤æ–‡ä»¶
- `GET /api/files/{file_id}/download` - ä¸‹è½½æ–‡ä»¶
- `GET /api/files/{file_id}/preview` - é¢„è§ˆæ–‡ä»¶

### ä»»åŠ¡ç®¡ç†
- `GET /api/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `POST /api/tasks` - åˆ›å»ºä»»åŠ¡
- `GET /api/tasks/{task_id}` - è·å–ä»»åŠ¡è¯¦æƒ…
- `PUT /api/tasks/{task_id}` - æ›´æ–°ä»»åŠ¡
- `DELETE /api/tasks/{task_id}` - åˆ é™¤ä»»åŠ¡
- `POST /api/tasks/{task_id}/export` - å¯¼å‡ºä»»åŠ¡æ•°æ®

### æ ‡æ³¨åŠŸèƒ½
- `GET /api/tasks/{task_id}/documents/{document_id}/annotation` - è·å–æ ‡æ³¨æ•°æ®
- `POST /api/tasks/{task_id}/documents/{document_id}/annotation` - ä¿å­˜æ ‡æ³¨æ•°æ®
- `POST /api/tasks/{task_id}/documents/{document_id}/submit` - æäº¤æ ‡æ³¨
- `GET /api/tasks/{task_id}/documents/{document_id}/review` - è·å–å¤å®¡æ•°æ®
- `POST /api/tasks/{task_id}/documents/{document_id}/review` - æäº¤å¤å®¡

## æ•°æ®å­˜å‚¨

ç³»ç»Ÿä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Œæ•°æ®ç›®å½•ç»“æ„ï¼š

```
data/
â”œâ”€â”€ users/
â”‚   â””â”€â”€ users.json              # ç”¨æˆ·ä¿¡æ¯
â”œâ”€â”€ public_files/               # å…¬å…±æ–‡ä»¶åº“
â”‚   â”œâ”€â”€ documents/              # æ–‡æ¡£æ–‡ä»¶
â”‚   â”œâ”€â”€ templates/              # æ¨¡æ¿æ–‡ä»¶
â”‚   â””â”€â”€ exports/                # å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ tasks.json              # ä»»åŠ¡åˆ—è¡¨
â”‚   â””â”€â”€ {task_id}/
â”‚       â””â”€â”€ annotations/        # æ ‡æ³¨æ•°æ®
â””â”€â”€ uploads/                    # ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶
```

## æƒé™æ§åˆ¶

| åŠŸèƒ½ | super_admin | admin | annotator |
|------|-------------|-------|-----------|
| ç”¨æˆ·ç®¡ç† | âœ… | âœ… | âŒ |
| æ–‡ä»¶ä¸Šä¼  | âœ… | âœ… | âœ… |
| æ–‡ä»¶åˆ é™¤ | âœ… | âœ… | ä»…è‡ªå·±ä¸Šä¼  |
| ä»»åŠ¡åˆ›å»º | âœ… | âœ… | ä»…åˆ†é…ç»™è‡ªå·± |
| ä»»åŠ¡åˆ†é… | âœ… | âœ… | âŒ |
| æ ‡æ³¨å·¥ä½œ | âœ… | âœ… | âœ… |
| å¤å®¡åŠŸèƒ½ | âœ… | âœ… | âŒ |

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„APIæ¥å£

1. åœ¨ `app/models/` ä¸­å®šä¹‰æ•°æ®æ¨¡å‹
2. åœ¨ `app/api/` ä¸­åˆ›å»ºè·¯ç”±æ–‡ä»¶
3. åœ¨ `app/api/__init__.py` ä¸­æ³¨å†Œè·¯ç”±
4. åœ¨ `app/core/storage.py` ä¸­æ·»åŠ å­˜å‚¨é€»è¾‘ï¼ˆå¦‚éœ€è¦ï¼‰

### æ‰©å±•å­˜å‚¨åŠŸèƒ½

å½“å‰ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Œå¦‚éœ€æ‰©å±•ä¸ºæ•°æ®åº“å­˜å‚¨ï¼š

1. ä¿®æ”¹ `app/core/storage.py`
2. æ·»åŠ æ•°æ®åº“è¿æ¥é…ç½®
3. å®ç°å¯¹åº”çš„ CRUD æ“ä½œ

## æ³¨æ„äº‹é¡¹

1. ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ `SECRET_KEY`
2. ç¡®ä¿ `data` ç›®å½•æœ‰é€‚å½“çš„è¯»å†™æƒé™
3. å®šæœŸå¤‡ä»½ `data` ç›®å½•ä¸­çš„é‡è¦æ•°æ®
4. ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ 