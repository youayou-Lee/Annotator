# 标注工作台使用指南

## 概述

标注工作台是一个完整的三栏布局标注界面，提供了直观高效的文档标注体验。支持动态表单生成、实时验证、自动保存等功能。

## 功能特性

### 🎯 核心功能

1. **三栏布局设计**
   - 左侧：文档列表导航
   - 中间：原始文档内容展示（Monaco Editor）
   - 右侧：动态标注表单

2. **动态表单生成**
   - 根据后端模板配置自动生成表单
   - 支持多种字段类型：string、text、number、boolean、date、select等
   - 支持复杂数据类型：array、object
   - 支持条件显示字段

3. **智能保存机制**
   - 自动保存（可开关）
   - 手动保存
   - 防抖处理避免频繁请求
   - 页面离开前提醒

4. **实时验证**
   - 表单字段实时验证
   - 错误提示和状态显示
   - 部分数据验证API集成

5. **便捷操作**
   - 键盘快捷键支持
   - 文档间快速切换
   - 进度显示和状态管理

### 🔧 技术特性

- **Monaco Editor**: 专业的代码编辑器展示JSON文档
- **Ant Design**: 完整的UI组件库
- **React Query**: 数据获取和缓存管理
- **TypeScript**: 完整的类型安全

## 界面布局

### 顶部导航栏
- 返回任务按钮
- 面包屑导航
- 进度显示（文档进度、任务进度）
- 状态标签（未保存、已完成、最后保存时间）

### 左侧文档列表
- 文档列表展示
- 状态标识（待标注、标注中、已完成）
- 当前文档高亮
- 进度条显示
- 刷新按钮

### 中间文档内容
- Monaco Editor展示原始JSON文档
- 只读模式
- 语法高亮
- 代码折叠
- 自动布局

### 右侧标注表单
- 动态生成的表单字段
- 自动保存开关
- 验证状态显示
- 滚动区域

### 底部操作栏
- 上一个/下一个文档按钮
- 快捷键提示
- 保存按钮
- 提交按钮

## 支持的字段类型

### 基础类型
- **string**: 单行文本输入
- **text**: 多行文本输入
- **number**: 数字输入（支持最大最小值）
- **boolean**: 开关组件

### 日期时间类型
- **date**: 日期选择器
- **datetime**: 日期时间选择器
- **time**: 时间选择器

### 选择类型
- **select**: 单选下拉框
- **multiselect**: 多选下拉框
- **radio**: 单选按钮组
- **checkbox**: 多选复选框组

### 复杂类型
- **array**: 数组类型（可添加删除项目）
- **object**: 对象类型（嵌套表单）

### 字段配置选项

```typescript
interface FormField {
  name: string                    // 字段名
  type: string                   // 字段类型
  required: boolean              // 是否必填
  label: string                  // 显示标签
  description?: string           // 字段描述
  placeholder?: string           // 占位符
  default?: any                  // 默认值
  options?: Array<{              // 选项（用于select等）
    value: string
    label: string
  }>
  validation?: {                 // 验证规则
    max_length?: number
    min_length?: number
    max_value?: number
    min_value?: number
    pattern?: string
    message?: string
  }
  ui?: {                        // UI配置
    rows?: number               // 文本框行数
    format?: string             // 日期格式
    showTime?: boolean          // 是否显示时间
  }
  conditional?: {               // 条件显示
    field: string               // 依赖字段
    value: any                  // 条件值
    operator: 'eq' | 'ne' | 'in' | 'not_in'
  }
}
```

## 快捷键

- **Ctrl+S**: 保存当前标注
- **Ctrl+Enter**: 提交当前标注
- **Ctrl+←**: 切换到上一个文档
- **Ctrl+→**: 切换到下一个文档

## API集成

### 主要接口

1. **获取文档列表**: `GET /annotations/{taskId}/documents`
2. **获取文档内容**: `GET /annotations/{taskId}/documents/{documentId}/content`
3. **获取表单配置**: `GET /annotations/{taskId}/documents/{documentId}/form-config`
4. **获取标注数据**: `GET /annotations/{taskId}/documents/{documentId}/annotation`
5. **保存标注数据**: `POST /annotations/{taskId}/documents/{documentId}/annotation`
6. **提交标注**: `POST /annotations/{taskId}/documents/{documentId}/submit`
7. **获取任务进度**: `GET /annotations/{taskId}/progress`
8. **实时验证**: `POST /annotations/validate-partial`

### 数据流程

1. 页面加载时获取任务信息、文档列表、当前文档内容和表单配置
2. 用户填写表单时触发实时验证
3. 自动保存或手动保存标注数据
4. 提交完成后自动跳转到下一个文档

## 使用流程

### 1. 进入标注工作台
- 从任务列表点击"开始标注"
- 或直接访问 `/tasks/{taskId}/documents/{documentId}/annotation`

### 2. 查看文档内容
- 中间区域显示原始JSON文档
- 可以折叠展开查看详细内容

### 3. 填写标注表单
- 右侧表单根据模板动态生成
- 必填字段有红色星号标识
- 实时显示验证错误

### 4. 保存和提交
- 开启自动保存后会自动保存更改
- 手动点击保存按钮
- 填写完成后点击提交

### 5. 切换文档
- 左侧列表点击其他文档
- 使用底部的上一个/下一个按钮
- 使用快捷键快速切换

## 状态管理

### 文档状态
- **pending**: 待标注
- **in_progress**: 标注中
- **completed**: 已完成
- **reviewed**: 已复审

### 保存状态
- 未保存更改会显示橙色标签
- 最后保存时间显示
- 页面离开前会提醒保存

## 错误处理

### 网络错误
- 自动重试机制
- 错误提示信息
- 离线状态检测

### 验证错误
- 实时字段验证
- 错误信息显示
- 阻止无效提交

### 数据冲突
- 并发编辑检测
- 数据版本控制
- 冲突解决提示

## 性能优化

### 数据缓存
- React Query缓存管理
- 智能数据更新
- 后台数据预取

### 防抖处理
- 自动保存防抖（2秒）
- 实时验证防抖（500ms）
- 避免频繁API调用

### 虚拟滚动
- 大量文档列表优化
- 表单字段懒加载
- 内存使用优化

## 扩展功能

### 自定义字段类型
- 支持插件式字段扩展
- 自定义验证规则
- 自定义UI组件

### 批量操作
- 批量标注功能
- 批量验证
- 批量导出

### 协作功能
- 多人同时标注
- 实时状态同步
- 评论和讨论

## 故障排除

### 常见问题

1. **页面加载缓慢**
   - 检查网络连接
   - 清除浏览器缓存
   - 联系管理员

2. **保存失败**
   - 检查表单验证错误
   - 确认网络连接
   - 重新登录

3. **表单不显示**
   - 检查模板配置
   - 刷新页面
   - 联系技术支持

### 技术支持

如遇到技术问题，请联系开发团队或查看系统日志获取详细错误信息。 