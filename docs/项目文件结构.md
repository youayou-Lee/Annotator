# 文书标注系统 - 项目文件结构文档

本文档提供了文书标注系统项目的文件结构概览，详细描述了各个目录和关键文件的作用。

## 顶层目录结构

项目主要由以下顶层目录组成：

```
annotator/
├── backend/         # 后端应用
├── data/            # 数据存储目录
├── docs/            # 项目文档
├── frontend/        # 前端应用
└── test_uploads/    # 测试上传文件目录
```

## 配置文件

### .env 文件

`.env` 文件是项目的环境配置文件，用于存储各种配置参数，避免将敏感信息硬编码到代码中。主要包括：

- **应用基础配置**：应用名称、版本、调试模式、API前缀等
- **数据库配置**：PostgreSQL数据库连接参数 
  - 数据库用户名: postgres
  - 数据库密码: 123456
  - 数据库名称: annotator
  - 连接地址: localhost:5432
- **Redis配置**：缓存和消息队列服务配置
- **JWT配置**：认证相关的令牌有效期设置
- **文件存储配置**：上传目录、大小限制、允许的文件类型
- **日志配置**：日志级别、格式、输出文件
- **Celery配置**：异步任务队列的配置参数

`.env`文件的主要作用：
1. 集中管理项目配置参数
2. 实现开发环境和生产环境的配置分离
3. 保护敏感信息（密码、密钥等）
4. 便于部署和环境迁移

## 后端 (backend/)

后端采用Python FastAPI框架，实现了RESTful API接口，负责处理前端请求、数据库交互和业务逻辑。系统使用PostgreSQL作为数据库，确保了数据的持久化存储和高效查询。

### 目录结构

```
backend/
├── alembic/                  # 数据库迁移工具目录
│   └── versions/             # 迁移版本文件
├── app/                      # 主应用代码
│   ├── api/                  # API接口模块
│   │   └── api_v1/           # API版本1
│   │       └── endpoints/    # 各功能模块端点
│   │
│   ├── core/                 # 核心配置和功能
│   ├── db/                   # 数据库相关
│   ├── models/               # 数据模型（ORM模型）
│   ├── schemas/              # 数据验证模式（Pydantic模型）
│   └── services/             # 业务逻辑服务
├── data/                     # 数据文件存储
│   └── public/               # 公共数据
├── migrations/               # 数据库迁移配置目录
└── tests/                    # 测试代码
```

### 核心文件

- `main.py`：应用入口点，初始化FastAPI应用和路由
- `alembic.ini`：Alembic数据库迁移配置文件
- `.env`：环境配置文件
- `create_postgres_db.py`：PostgreSQL数据库创建和初始化脚本
- `test_postgres_connection.py`：PostgreSQL数据库连接测试脚本
- `test_postgres_schema.py`：PostgreSQL数据库表结构检查脚本

### 应用模块 (app/)

#### API模块 (api/)

API模块包含所有接口端点定义，按功能分组：

- `auth.py`：身份认证相关接口（登录、注册、令牌刷新）
- `users.py`：用户管理接口
- `documents.py`：文档管理接口
- `tasks.py`：标注任务管理接口
- `annotations.py`：标注数据管理接口
- `public_files.py`：公共文件管理接口

#### 核心模块 (core/)

包含应用的核心配置和功能：

- `config.py`：应用配置加载和管理
- `security.py`：安全相关功能（密码哈希、JWT令牌）

#### 数据库模块 (db/)

数据库连接和会话管理：

- `base_class.py`：ORM基类定义
- `session.py`：数据库会话工厂

#### 数据模型 (models/)

SQLAlchemy ORM模型定义：

- `user.py`：用户模型
- `document.py`：文档模型
- `task.py`：标注任务模型
- `annotation.py`：标注数据模型
- `annotation_history.py`：标注历史记录模型
- `annotation_review.py`：标注审核模型
- `export_task.py`：导出任务模型

#### 数据验证模式 (schemas/)

Pydantic模型，用于请求/响应数据验证：

- `user.py`：用户数据模式
- `document.py`：文档数据模式
- `task.py`：任务数据模式
- `annotation.py`：标注数据模式

#### 服务模块 (services/)

业务逻辑实现：

- `user.py`：用户相关业务逻辑
- `document.py`：文档处理逻辑
- `task.py`：任务处理逻辑
- `annotation.py`：标注数据处理逻辑

## 前端 (frontend/)

前端采用React框架，使用TypeScript开发，实现用户交互界面。

### 目录结构

```
frontend/
├── public/              # 静态资源
└── src/                 # 源代码
    ├── assets/          # 静态资源（图片、图标等）
    ├── components/      # 可复用组件
    ├── context/         # React上下文
    ├── hooks/           # 自定义Hooks
    ├── layouts/         # 页面布局组件
    ├── pages/           # 页面组件
    ├── services/        # API服务
    ├── stores/          # 状态管理
    ├── utils/           # 工具函数
    └── __tests__/       # 测试文件
```

### 核心文件

- `package.json`：项目依赖和脚本
- `tsconfig.json`：TypeScript配置
- `vite.config.ts`：Vite打包工具配置
- `src/App.tsx`：应用主组件
- `src/main.tsx`：应用入口
- `src/services/api.ts`：API调用封装

### 组件模块 (components/)

包含可复用的UI组件：

- `AnnotationFieldEditor/`：标注字段编辑器组件
- `Breadcrumb/`：面包屑导航组件
- `FileUpload/`：文件上传组件

### 页面模块 (pages/)

应用的主要页面：

- `Login.tsx`：登录页面
- `Register.tsx`：注册页面
- `Dashboard.tsx`：仪表板/首页
- `DocumentList.tsx`：文档列表页
- `TaskList.tsx`：任务列表页
- `Annotation.tsx`：标注页面
- `UserManagement.tsx`：用户管理页面

### 服务模块 (services/)

API调用和数据处理服务：

- `api.ts`：API基础配置和请求拦截器
- `auth.ts`：认证相关API调用
- `document.ts`：文档相关API调用
- `task.ts`：任务相关API调用
- `annotation.ts`：标注相关API调用

### 状态管理 (stores/)

使用Zustand管理全局状态：

- `authStore.ts`：认证状态管理
- `userStore.ts`：用户状态管理
- `documentStore.ts`：文档状态管理
- `taskStore.ts`：任务状态管理
- `annotationStore.ts`：标注状态管理

## 数据存储 (data/)

用于存储上传的文档、导出的数据等文件：

```
data/
└── public/              # 公共数据
    ├── documents/       # 上传的文档
    ├── exports/         # 导出的数据
    ├── schemas/         # 标注模式定义
    └── templates/       # 标注模板
```

## 文档 (docs/)

项目相关的文档文件：

- `用户手册.md`：用户使用指南
- `技术规范.md`：开发技术规范
- `管理员指南.md`：系统管理员指南
- `PostgreSQL迁移指南.md`：数据库迁移文档
- `项目文件结构.md`：项目文件结构说明（本文档）

## 启动脚本

项目根目录包含多个启动脚本：

- `run-backend.ps1`：启动后端服务的PowerShell脚本
- `run-frontend.ps1`：启动前端服务的PowerShell脚本
- `start-annotator.ps1`：同时启动前后端的脚本 