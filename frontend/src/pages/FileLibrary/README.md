# 文件库管理功能

## 功能概述

文件库管理是文书标注系统的核心功能之一，提供了完整的文件上传、管理、预览和下载功能。

## 主要功能

### 1. 三类文件管理

#### 文档文件 (Documents)
- **支持格式**: JSON、JSONL
- **用途**: 存储需要标注的原始文档数据
- **权限**: 所有用户可上传，管理员可删除所有文件，普通用户只能删除自己上传的文件

#### 模板文件 (Templates)  
- **支持格式**: Python (.py)
- **用途**: 定义标注字段和验证规则的模板文件
- **权限**: 所有用户可上传，管理员可删除所有文件，普通用户只能删除自己上传的文件

#### 导出文件 (Exports)
- **支持格式**: 无限制
- **用途**: 存储标注完成后导出的结果文件
- **权限**: 只读，不支持上传，只提供下载功能

### 2. 文件操作功能

#### 文件上传
- 支持拖拽上传和点击选择上传
- 实时显示上传进度
- 文件格式和大小校验
- 上传成功后自动刷新文件列表

#### 文件预览
- 支持JSON、JSONL、Python文件的语法高亮预览
- 自动格式化JSON内容
- 显示文件基本信息（大小、路径等）

#### 文件下载
- 单个文件下载
- 批量文件下载
- 下载进度提示

#### 文件删除
- 单个文件删除（需确认）
- 批量文件删除（管理员权限）
- 权限控制：普通用户只能删除自己上传的文件

### 3. 文件管理功能

#### 搜索和过滤
- 按文件名搜索
- 按上传时间、文件大小、文件名排序
- 实时搜索结果更新

#### 批量操作
- 多选文件
- 批量下载
- 批量删除（管理员权限）

## 技术实现

### 前端组件结构
```
FileLibrary/
├── index.tsx              # 主页面组件
├── components/
│   ├── FileUpload.tsx     # 文件上传组件
│   ├── FileList.tsx       # 文件列表组件
│   └── FilePreview.tsx    # 文件预览组件
└── README.md              # 功能说明文档
```

### 主要技术栈
- **UI框架**: Ant Design
- **代码编辑器**: Monaco Editor (VS Code编辑器内核)
- **文件处理**: HTML5 File API
- **状态管理**: React Hooks (useState, useEffect)
- **HTTP客户端**: Axios

### API接口
- `GET /api/files?type={type}` - 获取文件列表
- `POST /api/files/upload` - 上传文件
- `DELETE /api/files/{file_id}` - 删除文件
- `GET /api/files/{file_id}/download` - 下载文件
- `GET /api/files/{file_id}/preview` - 预览文件内容

## 使用说明

### 1. 上传文件
1. 选择对应的文件类型标签页（文档文件/模板文件）
2. 将文件拖拽到上传区域，或点击"选择文件上传"按钮
3. 等待上传完成，系统会自动刷新文件列表

### 2. 预览文件
1. 在文件列表中点击"预览"按钮（眼睛图标）
2. 在弹出的预览窗口中查看文件内容
3. 支持语法高亮和JSON格式化

### 3. 下载文件
1. 单个下载：点击文件列表中的"下载"按钮
2. 批量下载：选择多个文件后，点击"批量下载"按钮

### 4. 删除文件
1. 单个删除：点击文件列表中的"删除"按钮，确认后删除
2. 批量删除：选择多个文件后，点击"批量删除"按钮（需要管理员权限）

### 5. 搜索和排序
1. 在搜索框中输入文件名进行搜索
2. 使用排序下拉菜单按不同条件排序
3. 点击"刷新"按钮重新加载文件列表

## 权限说明

### 普通用户 (annotator)
- ✅ 上传文档文件和模板文件
- ✅ 下载所有文件
- ✅ 预览所有文件
- ✅ 删除自己上传的文件
- ❌ 删除其他用户上传的文件
- ❌ 上传导出文件

### 管理员 (admin)
- ✅ 所有普通用户权限
- ✅ 删除任何用户上传的文件
- ✅ 批量删除文件

### 超级管理员 (super_admin)
- ✅ 所有管理员权限
- ✅ 系统级别的文件管理

## 注意事项

1. **文件大小限制**:
   - 文档文件: 最大50MB
   - 模板文件: 最大10MB

2. **文件格式限制**:
   - 文档文件只支持.json和.jsonl格式
   - 模板文件只支持.py格式
   - 导出文件无格式限制

3. **安全考虑**:
   - 所有文件上传都会进行格式验证
   - 用户只能删除自己上传的文件（除非是管理员）
   - 文件预览在沙箱环境中进行

4. **性能优化**:
   - 大文件预览采用流式加载
   - 文件列表支持分页显示
   - 批量操作采用异步处理 